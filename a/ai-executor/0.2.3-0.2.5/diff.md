# Comparing `tmp/ai-executor-0.2.3.tar.gz` & `tmp/ai-executor-0.2.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "ai-executor-0.2.3.tar", last modified: Mon May  8 06:51:09 2023, max compression
+gzip compressed data, was "ai-executor-0.2.5.tar", last modified: Mon May  8 08:34:47 2023, max compression
```

## Comparing `ai-executor-0.2.3.tar` & `ai-executor-0.2.5.tar`

### file list

```diff
@@ -1,13 +1,13 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-05-08 06:51:09.470246 ai-executor-0.2.3/
--rw-r--r--   0 root         (0) root         (0)      784 2023-05-08 06:51:09.470246 ai-executor-0.2.3/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)      478 2023-05-08 04:32:13.000000 ai-executor-0.2.3/README.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-05-08 06:51:09.469246 ai-executor-0.2.3/ai_executor/
--rw-r--r--   0 root         (0) root         (0)     3280 2023-05-08 06:34:26.000000 ai-executor-0.2.3/ai_executor/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-05-08 06:51:09.470246 ai-executor-0.2.3/ai_executor.egg-info/
--rw-r--r--   0 root         (0) root         (0)      784 2023-05-08 06:51:09.000000 ai-executor-0.2.3/ai_executor.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)      216 2023-05-08 06:51:09.000000 ai-executor-0.2.3/ai_executor.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2023-05-08 06:51:09.000000 ai-executor-0.2.3/ai_executor.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)        7 2023-05-08 06:51:09.000000 ai-executor-0.2.3/ai_executor.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)       12 2023-05-08 06:51:09.000000 ai-executor-0.2.3/ai_executor.egg-info/top_level.txt
--rw-r--r--   0 root         (0) root         (0)       38 2023-05-08 06:51:09.470246 ai-executor-0.2.3/setup.cfg
--rw-r--r--   0 root         (0) root         (0)      487 2023-05-08 06:50:19.000000 ai-executor-0.2.3/setup.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-05-08 08:34:47.694619 ai-executor-0.2.5/
+-rw-r--r--   0 root         (0) root         (0)      784 2023-05-08 08:34:47.693619 ai-executor-0.2.5/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)      478 2023-05-08 08:27:00.000000 ai-executor-0.2.5/README.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-05-08 08:34:47.692618 ai-executor-0.2.5/ai_executor/
+-rw-r--r--   0 root         (0) root         (0)     4064 2023-05-08 08:32:15.000000 ai-executor-0.2.5/ai_executor/__init__.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-05-08 08:34:47.693619 ai-executor-0.2.5/ai_executor.egg-info/
+-rw-r--r--   0 root         (0) root         (0)      784 2023-05-08 08:34:47.000000 ai-executor-0.2.5/ai_executor.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)      216 2023-05-08 08:34:47.000000 ai-executor-0.2.5/ai_executor.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-05-08 08:34:47.000000 ai-executor-0.2.5/ai_executor.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)        7 2023-05-08 08:34:47.000000 ai-executor-0.2.5/ai_executor.egg-info/requires.txt
+-rw-r--r--   0 root         (0) root         (0)       12 2023-05-08 08:34:47.000000 ai-executor-0.2.5/ai_executor.egg-info/top_level.txt
+-rw-r--r--   0 root         (0) root         (0)       38 2023-05-08 08:34:47.694619 ai-executor-0.2.5/setup.cfg
+-rw-r--r--   0 root         (0) root         (0)      470 2023-05-08 08:34:45.000000 ai-executor-0.2.5/setup.py
```

### Comparing `ai-executor-0.2.3/PKG-INFO` & `ai-executor-0.2.5/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ai-executor
-Version: 0.2.3
+Version: 0.2.5
 Summary: A Python package for executing methods generated by ChatGPT
 Home-page: https://github.com/ZS520L/LegoAI-by-AUST
 Author: LegoAI
 Author-email: li17719333702@gmail.com
 License: UNKNOWN
 Platform: UNKNOWN
 Description-Content-Type: text/markdown
```

### Comparing `ai-executor-0.2.3/ai_executor/__init__.py` & `ai-executor-0.2.5/ai_executor/__init__.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,76 +1,94 @@
 import openai
 import os
 import json
 
 class AI:
-    def __init__(self, chatgpt_api_key, mode='gpt'):
+    def __init__(self, chatgpt_api_key, mode='gpt', cache=True):
         self.chatgpt_api_key = chatgpt_api_key
         self.mode = mode
         self.generated_code_cache = {}
         self.cache_file = "code_cache.json"
-
-        if os.path.exists(self.cache_file):
-            with open(self.cache_file, "r") as f:
-                self.generated_code_cache = json.load(f)
+        self.cache = cache
+        if cache:
+            if os.path.exists(self.cache_file):
+                with open(self.cache_file, "r") as f:
+                    self.generated_code_cache = json.load(f)
 
     def __getattr__(self, method_name):
         def method(*args, **kwargs):
             if method_name in self.generated_code_cache:
                 generated_code = self.generated_code_cache[method_name]
                 print("代码从缓存中获取")
+                
             else:
                 generated_code = self.call_chatgpt(method_name, *args, **kwargs)
                 print("首次生成的代码")
 
             print('#################code#################')
             print(generated_code)
             print('######################################')
 
             try:
                 exec(generated_code, globals())
-
-                if method_name not in self.generated_code_cache:
-                    self.generated_code_cache[method_name] = generated_code
-                    with open(self.cache_file, "w") as f:
-                        json.dump(self.generated_code_cache, f)
-
-            except Exception as e:
-                print(f"执行生成代码时出错: {e}")
-                return None
-            # 使用 eval 根据函数名称从全局名称空间调用函数，并将参数传递给函数
-            try:
                 result = eval(f"{method_name}(*args, **kwargs)")
-                # print('######################################')
-                print(result,'\n\n')
+                print('函数输出：',result,'\n\n')
+                if self.cache:
+                    if method_name not in self.generated_code_cache:
+                        self.generated_code_cache[method_name] = generated_code
+                        with open(self.cache_file, "w") as f:
+                            json.dump(self.generated_code_cache, f)
                 return result
             except Exception as e:
-                print(f"调用函数时出错: {e}")
+                print(f"生成或执行代码时出错: {e}")
                 return None
+            
 
         return method
 
     def call_chatgpt(self, method_name, *args, **kwargs):
-        # prompt = f"编写一个Python函数，名为{method_name}，接受以下参数：{args} {kwargs}。请根据函数名推理并实现该函数，不需要测试。注意：只输出函数代码，不要包含其他无关信息。"
-        prompt = f"编写一个Python函数，函数名必须为{method_name}，接受以下参数：{args} {kwargs}，请根据函数名推理并实现该函数，不需要测试。要求只输出代码，无需任何解释"
-        
+        prompt = f"你是一个乐于助人的python专家，擅长编写各种python函数。\
+        请帮我编写一个Python函数，函数命名为<{method_name}>，\
+        你不可以对函数名做任何改动！传入的参数示例为：*{args}。\
+        请给每个参数都设置一个默认参数。保证用户传参和函数要求一致。\
+        请根据函数名和参数示例推理并实现该函数，不能用pass敷衍！\
+        函数的结果必须要<return出来>而不是print\
+        不需要测试！要求只输出代码，无需任何解释"
         openai.api_key = self.chatgpt_api_key
 
         if self.mode == 'davinci':
             response = openai.Completion.create(
                 engine="text-davinci-003",
                 prompt=prompt,
                 max_tokens=150,
                 n=1,
                 stop=None,
                 temperature=0.5,
             )
-            return response.choices[0].text.strip()
+            return response.choices[0].text.replace('。','').replace('！','').replace('```python','').replace('```','').strip()
 
         if self.mode == 'gpt':
-            response = openai.ChatCompletion.create(
-                model='gpt-3.5-turbo',
-                messages=eval('[{"role":"user", "content":"' + prompt + '"}]'),
-                temperature=0
-            )
-            assistant_response = response.choices[0].message['content']
-            return assistant_response.replace('```python','').replace('```','').strip()
+            try:
+                response = openai.ChatCompletion.create(
+                    model='gpt-3.5-turbo',
+                    messages=eval('[{"role":"user", "content":"' + prompt + '"}]'),
+                    temperature=0
+                )
+                assistant_response = response.choices[0].message['content']
+                return assistant_response.replace('```python','').replace('```','').strip()
+            except Exception as e:
+                print(f"生成或执行代码时出错: {e}")
+                response = openai.Completion.create(
+                engine="text-davinci-003",
+                prompt=prompt,
+                max_tokens=150,
+                n=1,
+                stop=None,
+                temperature=0.5,
+                )
+                return response.choices[0].text.replace('。','').replace('！','').replace('```python','').replace('```','').strip()
+
+if __name__ == '__main__':
+    # 测试用例
+    ai = AI("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")
+    ai.plot绘制柱状图([2,3])
+    ai.plot绘制柱状图([2,3,7])
```

### Comparing `ai-executor-0.2.3/ai_executor.egg-info/PKG-INFO` & `ai-executor-0.2.5/ai_executor.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ai-executor
-Version: 0.2.3
+Version: 0.2.5
 Summary: A Python package for executing methods generated by ChatGPT
 Home-page: https://github.com/ZS520L/LegoAI-by-AUST
 Author: LegoAI
 Author-email: li17719333702@gmail.com
 License: UNKNOWN
 Platform: UNKNOWN
 Description-Content-Type: text/markdown
```

