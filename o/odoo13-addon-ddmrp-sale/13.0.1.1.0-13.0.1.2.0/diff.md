# Comparing `tmp/odoo13_addon_ddmrp_sale-13.0.1.1.0-py3-none-any.whl.zip` & `tmp/odoo13_addon_ddmrp_sale-13.0.1.2.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,22 +1,22 @@
-Zip file size: 17746 bytes, number of entries: 20
--rw-r--r--  2.0 unx     3033 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/README.rst
--rw-r--r--  2.0 unx       21 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/__init__.py
--rw-r--r--  2.0 unx      669 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/__manifest__.py
--rw-r--r--  2.0 unx     1095 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/i18n/ddmrp_sale.pot
--rw-r--r--  2.0 unx       57 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/models/__init__.py
--rw-r--r--  2.0 unx      677 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/models/sale_order_line.py
--rw-r--r--  2.0 unx     2305 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/models/stock_buffer.py
--rw-r--r--  2.0 unx       38 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      210 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx       72 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/readme/HISTORY.rst
--rw-r--r--  2.0 unx     2440 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/static/description/icon.png
--rw-r--r--  2.0 unx    12528 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/static/description/index.html
--rw-r--r--  2.0 unx       30 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/tests/__init__.py
--rw-r--r--  2.0 unx     4485 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/tests/test_ddmrp_sale.py
--rw-r--r--  2.0 unx      851 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/views/sale_order_view.xml
--rw-r--r--  2.0 unx      633 b- defN 21-Apr-27 09:21 odoo/addons/ddmrp_sale/views/stock_buffer_view.xml
--rw-r--r--  2.0 unx     3721 b- defN 21-Apr-27 09:21 odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 21-Apr-27 09:21 odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 21-Apr-27 09:21 odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     1979 b- defN 21-Apr-27 09:21 odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/RECORD
-20 files, 34941 bytes uncompressed, 14380 bytes compressed:  58.8%
+Zip file size: 18360 bytes, number of entries: 20
+-rw-r--r--  2.0 unx     3033 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/__init__.py
+-rw-r--r--  2.0 unx      669 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/__manifest__.py
+-rw-r--r--  2.0 unx     1425 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/i18n/ddmrp_sale.pot
+-rw-r--r--  2.0 unx       57 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/models/__init__.py
+-rw-r--r--  2.0 unx      677 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/models/sale_order_line.py
+-rw-r--r--  2.0 unx     3657 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/models/stock_buffer.py
+-rw-r--r--  2.0 unx       38 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      210 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx       72 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/readme/HISTORY.rst
+-rw-r--r--  2.0 unx     2440 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/static/description/icon.png
+-rw-r--r--  2.0 unx    12528 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/static/description/index.html
+-rw-r--r--  2.0 unx       30 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/tests/__init__.py
+-rw-r--r--  2.0 unx     4485 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/tests/test_ddmrp_sale.py
+-rw-r--r--  2.0 unx      851 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/views/sale_order_view.xml
+-rw-r--r--  2.0 unx     1228 b- defN 23-May-08 09:57 odoo/addons/ddmrp_sale/views/stock_buffer_view.xml
+-rw-r--r--  2.0 unx     3759 b- defN 23-May-08 09:58 odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-08 09:58 odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-May-08 09:58 odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     1980 b- defN 23-May-08 09:58 odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/RECORD
+20 files, 37257 bytes uncompressed, 14994 bytes compressed:  59.8%
```

## zipnote {}

```diff
@@ -42,20 +42,20 @@
 
 Filename: odoo/addons/ddmrp_sale/views/sale_order_view.xml
 Comment: 
 
 Filename: odoo/addons/ddmrp_sale/views/stock_buffer_view.xml
 Comment: 
 
-Filename: odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/METADATA
+Filename: odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/WHEEL
+Filename: odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/top_level.txt
+Filename: odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/RECORD
+Filename: odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/ddmrp_sale/__manifest__.py

```diff
@@ -1,14 +1,14 @@
 # Copyright 2021 ForgeFlow S.L. (https://www.forgeflow.com)
 # License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html).
 
 {
     "name": "DDMRP Sale",
     "summary": "DDMRP integration with Sales app.",
-    "version": "13.0.1.1.0",
+    "version": "13.0.1.2.0",
     "development_status": "Beta",
     "author": "ForgeFlow, Odoo Community Association (OCA)",
     "maintainers": ["LoisRForgeFlow"],
     "website": "https://github.com/OCA/ddmrp",
     "category": "Warehouse Management",
     "depends": ["ddmrp", "sale_order_line_date", "ddmrp_exclude_moves_adu_calc"],
     "data": ["views/stock_buffer_view.xml", "views/sale_order_view.xml"],
```

## odoo/addons/ddmrp_sale/i18n/ddmrp_sale.pot

```diff
@@ -27,15 +27,25 @@
 #: model:ir.model.fields,help:ddmrp_sale.field_sale_order_line__exclude_from_adu
 msgid ""
 "If this flag is set related stock moves will be excluded from ADU "
 "calculation"
 msgstr ""
 
 #. module: ddmrp_sale
+#: model:ir.model.fields,field_description:ddmrp_sale.field_stock_buffer__qualified_demand_sale_order_line_ids
+msgid "Qualified Demand Sale Order Line"
+msgstr ""
+
+#. module: ddmrp_sale
 #: model:ir.model,name:ddmrp_sale.model_sale_order_line
 msgid "Sales Order Line"
 msgstr ""
 
 #. module: ddmrp_sale
 #: model:ir.model,name:ddmrp_sale.model_stock_buffer
 msgid "Stock Buffer"
 msgstr ""
+
+#. module: ddmrp_sale
+#: model_terms:ir.ui.view,arch_db:ddmrp_sale.stock_buffer_view_form
+msgid "View Qualified Demand from SO Lines"
+msgstr ""
```

## odoo/addons/ddmrp_sale/models/stock_buffer.py

```diff
@@ -4,14 +4,17 @@
 from odoo import api, fields, models
 
 
 class StockBuffer(models.Model):
     _inherit = "stock.buffer"
 
     can_serve_sales = fields.Boolean(compute="_compute_can_serve_sales", store=True,)
+    qualified_demand_sale_order_line_ids = fields.Many2many(
+        comodel_name="sale.order.line",
+    )
 
     def _get_sale_source_location(self):
         self.ensure_one()
         proc_loc = self.env.ref("stock.stock_location_customers")
         values = {
             "warehouse_id": self.warehouse_id,
             "company_id": self.company_id,
@@ -40,22 +43,50 @@
         ]
 
     def _search_sales_qualified_demand(self):
         domain = self._search_sales_qualified_demand_domain()
         so_lines = self.env["sale.order.line"].search(domain)
         return so_lines
 
-    def _get_demand_by_days(self):
-        demand_by_days = super()._get_demand_by_days()
-        if self.can_serve_sales:
-            so_lines = self._search_sales_qualified_demand()
-
-            sol_dates = [dt.date() for dt in so_lines.mapped("commitment_date")]
-            for d in sol_dates:
-                if not demand_by_days.get(d):
-                    demand_by_days[d] = 0.0
-            for sol in so_lines:
-                date = sol.commitment_date.date()
-                demand_by_days[date] += sol.product_uom._compute_quantity(
-                    sol.product_uom_qty, sol.product_id.uom_id
-                )
-        return demand_by_days
+    def _get_so_lines_by_days(self, so_lines):
+        so_lines_by_days = {}
+        sol_dates = [dt.date() for dt in so_lines.mapped("commitment_date")]
+        for d in sol_dates:
+            if not so_lines_by_days.get(d):
+                so_lines_by_days[d] = 0.0
+        for sol in so_lines:
+            date = sol.commitment_date.date()
+            so_lines_by_days[date] += sol.product_uom._compute_quantity(
+                sol.product_uom_qty, sol.product_id.uom_id
+            )
+        return so_lines_by_days
+
+    def _calc_qualified_demand(self, current_date=False):
+        res = super()._calc_qualified_demand(current_date)
+        today = current_date or fields.date.today()
+        for rec in self:
+            if rec.can_serve_sales:
+                qualified_demand = 0.0
+                lines = rec._search_sales_qualified_demand()
+                so_lines_by_days = rec._get_so_lines_by_days(lines)
+                dates = list(set(so_lines_by_days.keys()))
+                for date in dates:
+                    if (
+                        so_lines_by_days.get(date, 0.0) >= rec.order_spike_threshold
+                        or date <= today
+                    ):
+                        qualified_demand += so_lines_by_days.get(date, 0.0)
+                    else:
+                        lines = lines.filtered(
+                            lambda x: x.commitment_date.date() != date
+                        )
+                rec.qualified_demand += qualified_demand
+                rec.qualified_demand_sale_order_line_ids = lines
+        return res
+
+    def action_view_qualified_demand_so_lines(self):
+        lines = self.qualified_demand_sale_order_line_ids
+        action = self.env.ref("sale.action_quotations")
+        result = action.read()[0]
+        result["context"] = {}
+        result["domain"] = [("id", "in", lines.mapped("order_id.id"))]
+        return result
```

## odoo/addons/ddmrp_sale/views/stock_buffer_view.xml

### odoo/addons/ddmrp_sale/views/stock_buffer_view.xml

```diff
@@ -3,13 +3,17 @@
      License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl-3.0) -->
 <odoo>
   <record id="stock_buffer_view_form" model="ir.ui.view">
     <field name="name">stock.buffer.form - ddmrp_sale</field>
     <field name="model">stock.buffer</field>
     <field name="inherit_id" ref="ddmrp.stock_buffer_view_form"/>
     <field name="arch" type="xml">
-      <group name="misc_info" position="inside">
+      <xpath expr="//div[@name='qualified_demand']" position="inside" class="o_row">
+        <field name="qualified_demand_sale_order_line_ids" invisible="1"/>
+        <button title="View Qualified Demand from SO Lines" name="action_view_qualified_demand_so_lines" icon="fa-search" type="object" attrs="{'invisible': [('qualified_demand_sale_order_line_ids', '=', [])]}"/>
+      </xpath>
+      <field name="company_id" position="after">
         <field name="can_serve_sales"/>
-      </group>
+      </field>
     </field>
   </record>
 </odoo>
```

## Comparing `odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/METADATA` & `odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,18 +1,19 @@
 Metadata-Version: 2.1
 Name: odoo13-addon-ddmrp-sale
-Version: 13.0.1.1.0
+Version: 13.0.1.2.0
 Summary: DDMRP integration with Sales app.
 Home-page: https://github.com/OCA/ddmrp
 Author: ForgeFlow, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: LGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
+Classifier: Framework :: Odoo :: 13.0
 Classifier: License :: OSI Approved :: GNU Lesser General Public License v3 (LGPLv3)
 Classifier: Development Status :: 4 - Beta
 Requires-Python: >=3.5
 Requires-Dist: odoo13-addon-ddmrp
 Requires-Dist: odoo13-addon-ddmrp-exclude-moves-adu-calc
 Requires-Dist: odoo13-addon-sale-order-line-date
 Requires-Dist: odoo (<13.1dev,>=13.0a)
```

## Comparing `odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/RECORD` & `odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/RECORD`

 * *Files 22% similar despite different names*

```diff
@@ -1,20 +1,20 @@
 odoo/addons/ddmrp_sale/README.rst,sha256=8boIpoo5zHhuYM0V-msmc7hNtaHjUYhoyUwezIdevJM,3033
 odoo/addons/ddmrp_sale/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/ddmrp_sale/__manifest__.py,sha256=gWH8OaRiOLdzZIWTFLQ0OpJwlsclLEIchsBmaOC-YB0,669
-odoo/addons/ddmrp_sale/i18n/ddmrp_sale.pot,sha256=UrPq7b2r-Tr0BkTyytINEWHOPNwIWLN61nHTvFyR_As,1095
+odoo/addons/ddmrp_sale/__manifest__.py,sha256=_b75qrJ05qTp2RrAH8kdyp4mgwrmAMqXjdLY8w4bKGA,669
+odoo/addons/ddmrp_sale/i18n/ddmrp_sale.pot,sha256=QbVZzqQsOD6g4Te7OUXjkhxBm9E2lcCzE0Hq2rcrq0k,1425
 odoo/addons/ddmrp_sale/models/__init__.py,sha256=OiQ4eBQw-uorr8uZadmvrttWNBXdlY7Q0o1eWc-AtHQ,57
 odoo/addons/ddmrp_sale/models/sale_order_line.py,sha256=PWsN3NdfnY3QPWNeXqyVg6syKMBynCjRhaYY-tF2V5E,677
-odoo/addons/ddmrp_sale/models/stock_buffer.py,sha256=kb03iPe_oqn2GrX0cyw8knkvxGeU_b_Gv357Sok50us,2305
+odoo/addons/ddmrp_sale/models/stock_buffer.py,sha256=8JYQbjUOyjmUxMy4GKU9paCgcNY5nhvFMEnOlTp2mp0,3657
 odoo/addons/ddmrp_sale/readme/CONTRIBUTORS.rst,sha256=Cbu_K7Qrt8rzIYgqHpSwJuxQPnqX4q22lJVGBwVTWao,38
 odoo/addons/ddmrp_sale/readme/DESCRIPTION.rst,sha256=nR0e2oMMxsozF37v0BUpcGZdMewsnJcHssOjba5_1Z8,210
 odoo/addons/ddmrp_sale/readme/HISTORY.rst,sha256=-w1uKvPwuL8yx0g9xCDvc8cIrUX9XIYpzG-1FTPPghg,72
 odoo/addons/ddmrp_sale/static/description/icon.png,sha256=5uSJu9EpLWi4sLT2J8UeccFnsVlygstvEMZStX5Sw1c,2440
 odoo/addons/ddmrp_sale/static/description/index.html,sha256=zpbtoyOAxje2AU7no3KRESUgSXEBxHZUQHLR9OTOb8Q,12528
 odoo/addons/ddmrp_sale/tests/__init__.py,sha256=G_YVWrfVOnngHlgiRv5KSozotj7Lkx7ATWg33FsGSQM,30
 odoo/addons/ddmrp_sale/tests/test_ddmrp_sale.py,sha256=baBNtd-l2hSWIKhNBfHif6WvL4uoebjEUL3d4t3VTx0,4485
 odoo/addons/ddmrp_sale/views/sale_order_view.xml,sha256=_jzfAbCJcLHKHDpbniPu1myUdwuuJxh43FjPV6Ap60I,851
-odoo/addons/ddmrp_sale/views/stock_buffer_view.xml,sha256=sU7eT3w_Cg8Bf2jBbZ73fBz3C4pCkitX-CJ5wW8Hu7I,633
-odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/METADATA,sha256=5LaH_LXp5r7ZAiFB5Gd1tDstF8s0p30XsiEdFP5rapM,3721
-odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
-odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo13_addon_ddmrp_sale-13.0.1.1.0.dist-info/RECORD,,
+odoo/addons/ddmrp_sale/views/stock_buffer_view.xml,sha256=850PxLSszUYjT3H5KBtTkhittYIR9TZYi5l9u_i4WcQ,1228
+odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/METADATA,sha256=IHokPBUxrlb2qML6Zqc63tU1m3euj6S11c8h65NzHfk,3759
+odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo13_addon_ddmrp_sale-13.0.1.2.0.dist-info/RECORD,,
```

